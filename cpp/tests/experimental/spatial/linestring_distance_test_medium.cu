/*
 * Copyright (c) 2022, NVIDIA CORPORATION.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

#include <cuspatial_test/vector_equality.hpp>
#include <cuspatial_test/vector_factories.cuh>

#include <cuspatial/error.hpp>
#include <cuspatial/experimental/iterator_factory.cuh>
#include <cuspatial/experimental/linestring_distance.cuh>
#include <cuspatial/experimental/ranges/multilinestring_range.cuh>
#include <cuspatial/vec_2d.hpp>

#include <rmm/device_vector.hpp>

#include <thrust/iterator/constant_iterator.h>
#include <thrust/iterator/counting_iterator.h>

#include <type_traits>

using namespace cuspatial;
using namespace cuspatial::test;

template <typename T>
struct PairwiseLinestringDistanceTestMedium : public ::testing::Test {
};

// float and double are logically the same but would require separate tests due to precision.
using TestTypes = ::testing::Types<float, double>;
TYPED_TEST_CASE(PairwiseLinestringDistanceTestMedium, TestTypes);

TYPED_TEST(PairwiseLinestringDistanceTestMedium, RandomDataset100)
{
  using T                  = TypeParam;
  auto constexpr num_pairs = 100;

  auto linestring1_offsets = make_device_vector<int32_t>(
    {0,   4,   8,   11,  13,  16,  19,  22,  25,  28,  32,  36,  40,  44,  48,  51,  54,
     57,  61,  63,  65,  67,  71,  74,  78,  82,  85,  87,  89,  92,  96,  99,  101, 104,
     108, 112, 115, 119, 123, 127, 130, 132, 135, 137, 141, 145, 147, 150, 153, 155, 158,
     160, 164, 167, 170, 173, 176, 179, 182, 184, 188, 192, 194, 198, 202, 206, 209, 212,
     215, 217, 220, 222, 226, 228, 230, 233, 237, 239, 243, 247, 250, 252, 254, 257, 259,
     263, 266, 269, 273, 276, 280, 283, 286, 290, 294, 298, 300, 302, 306, 308, 311});

  auto linestring1_points_xy = make_device_vector<T>({41658.902315589876,
                                                      14694.11814724456,
                                                      46600.70359801489,
                                                      8771.431887804214,
                                                      47079.510547637154,
                                                      10199.68027155776,
                                                      51498.48049880379,
                                                      17049.62665643919,
                                                      -27429.917796286478,
                                                      -33240.8339287343,
                                                      -21764.269974046114,
                                                      -37974.45515744517,
                                                      -14460.71813363161,
                                                      -31333.481529957502,
                                                      -18226.13032712476,
                                                      -30181.03842467982,
                                                      -22556.235212018168,
                                                      41094.0501840996,
                                                      -16375.655690574613,
                                                      42992.319790050366,
                                                      -20082.724633593425,
                                                      33759.13529113619,
                                                      26809.34874258138,
                                                      -44038.61029577575,
                                                      26656.809525288947,
                                                      -43753.338844714024,
                                                      37540.565197328295,
                                                      15638.266868017672,
                                                      36984.75276605113,
                                                      17679.849722737585,
                                                      41981.578395349155,
                                                      13344.429419617965,
                                                      24973.02375952172,
                                                      58735.45872458056,
                                                      19250.902968701903,
                                                      57585.91906288884,
                                                      20165.256326220195,
                                                      59003.13030366512,
                                                      -30532.18325215106,
                                                      -37453.38802730886,
                                                      -32135.262234862337,
                                                      -36689.9824564741,
                                                      -22826.652288925623,
                                                      -33888.1663960553,
                                                      -17439.962727300197,
                                                      57339.487213868444,
                                                      -19359.179053658157,
                                                      51513.83286101961,
                                                      -20575.92273561565,
                                                      46633.76851694451,
                                                      9500.159032106982,
                                                      9451.145716270374,
                                                      6568.682357949907,
                                                      6486.956110744754,
                                                      4981.961021893829,
                                                      4957.81628227334,
                                                      -21889.03381442112,
                                                      29939.875040449275,
                                                      -23236.68404277722,
                                                      29478.765053663003,
                                                      -20541.236096645694,
                                                      29043.078772533325,
                                                      -20778.38844417717,
                                                      35716.735488752434,
                                                      -57875.32424881095,
                                                      -59612.15306180189,
                                                      -51612.57611847265,
                                                      -59294.38873712498,
                                                      -47437.091112564274,
                                                      -59127.907287882874,
                                                      -50197.81791907972,
                                                      -55907.11718469079,
                                                      -56989.35149478826,
                                                      -12026.40853005452,
                                                      -50735.07273259827,
                                                      -15241.391847088236,
                                                      -53459.1335853405,
                                                      -10462.08756300849,
                                                      -47317.19439336836,
                                                      -12371.368617841707,
                                                      -6829.050709717398,
                                                      37044.87138428305,
                                                      -2732.682737868703,
                                                      33021.25289675412,
                                                      -5966.9880402461695,
                                                      34610.915204761666,
                                                      385.7819993385874,
                                                      40011.84905629743,
                                                      -36083.360810904385,
                                                      25902.54295777333,
                                                      -41081.45575117335,
                                                      25768.144614748064,
                                                      -35733.010967268594,
                                                      20564.043901966274,
                                                      -36247.474479077006,
                                                      22714.109069724822,
                                                      -46951.78590147328,
                                                      12875.546088919305,
                                                      -47262.641809761204,
                                                      13893.756714962012,
                                                      -47684.95897589372,
                                                      13490.506594342487,
                                                      38981.49756281363,
                                                      14727.611347924598,
                                                      35164.86749845841,
                                                      10689.244931054465,
                                                      35579.262138939965,
                                                      17538.521291377492,
                                                      59176.59704717483,
                                                      23982.713915777626,
                                                      58533.33560306961,
                                                      24390.498281955253,
                                                      58725.469004504834,
                                                      24762.865678427796,
                                                      54054.39482381586,
                                                      -45064.46593058627,
                                                      48926.88038791325,
                                                      -37966.64921236699,
                                                      51732.8876978247,
                                                      -46059.58460159569,
                                                      53489.896558495035,
                                                      -49120.96511713206,
                                                      -44876.184453934664,
                                                      -44360.42961138337,
                                                      -47637.45499043422,
                                                      -45008.80023662591,
                                                      -58724.07892996805,
                                                      2094.812598127086,
                                                      -54674.126544740386,
                                                      2085.895936089219,
                                                      60635.37331725002,
                                                      2573.1373108541593,
                                                      62105.58031557918,
                                                      1104.7361987014294,
                                                      -5514.764938002292,
                                                      3308.886287290079,
                                                      -6644.854901584,
                                                      698.8137866817374,
                                                      -10776.990254158663,
                                                      5393.567671690889,
                                                      -10887.375444705547,
                                                      5707.221420960841,
                                                      -16308.6192426665,
                                                      55013.396940812236,
                                                      -17943.665926700574,
                                                      55544.470228068916,
                                                      -18590.60450856736,
                                                      57224.00315655217,
                                                      -54635.44517293027,
                                                      34758.586091369114,
                                                      -54223.234081035494,
                                                      31679.59372669221,
                                                      -55991.88318145398,
                                                      33674.127549160745,
                                                      -55476.50649203067,
                                                      33712.78136073219,
                                                      -16828.926382989048,
                                                      -31333.200170105112,
                                                      -20874.261277556023,
                                                      -29605.973372869845,
                                                      -21556.654292334166,
                                                      -35481.31451239508,
                                                      -21941.300770415983,
                                                      -35017.537957551656,
                                                      19602.183464230096,
                                                      63130.3997634869,
                                                      20124.423199257864,
                                                      56201.98002258745,
                                                      22857.521915468602,
                                                      59459.34956278938,
                                                      -40252.218652315016,
                                                      27897.179108036376,
                                                      -40615.87902328277,
                                                      34867.09647977925,
                                                      -13227.295520406573,
                                                      49218.47853186974,
                                                      -13394.780584665317,
                                                      41205.40159441225,
                                                      -41859.97648749311,
                                                      34123.82321041233,
                                                      -41313.45210522428,
                                                      29333.279117753587,
                                                      -38298.22583610271,
                                                      29621.64904140896,
                                                      19267.410152329292,
                                                      50324.3631913836,
                                                      11889.896156569695,
                                                      49593.72552280869,
                                                      13200.16827668008,
                                                      49929.12541850021,
                                                      19386.646807861616,
                                                      55527.05140347529,
                                                      -60021.453586243275,
                                                      55909.86001855173,
                                                      -56555.20891834299,
                                                      47223.27157870629,
                                                      -58162.220568779645,
                                                      46241.01648214377,
                                                      -21564.27114522246,
                                                      -43556.091011791155,
                                                      -26413.185516939815,
                                                      -37643.13228249952,
                                                      -8121.46414404954,
                                                      -56220.36407542113,
                                                      -2680.751998537391,
                                                      -62305.120350499754,
                                                      -2222.8256113393886,
                                                      -61076.48504318068,
                                                      -43496.28457602764,
                                                      -17972.088889636892,
                                                      -48670.608599013554,
                                                      -21976.442708667066,
                                                      -51456.69654638918,
                                                      -19176.50505543119,
                                                      -52025.6273644588,
                                                      -18904.22729632036,
                                                      -49836.99743938117,
                                                      -19263.800263562145,
                                                      -46727.06695784684,
                                                      -12538.24458831298,
                                                      -37385.58991765429,
                                                      -9827.528489899312,
                                                      -37794.42212261821,
                                                      -10414.915634760691,
                                                      36860.87308416238,
                                                      23911.34358298873,
                                                      42873.67992713083,
                                                      23596.14312044066,
                                                      39313.39701688439,
                                                      17829.62627312683,
                                                      11431.213542784448,
                                                      43915.88050116565,
                                                      7647.058473635509,
                                                      50879.02714367026,
                                                      11107.49195048625,
                                                      49993.15637259206,
                                                      11643.093760750395,
                                                      52166.07547584346,
                                                      -45871.68320713149,
                                                      8607.802738756523,
                                                      -45986.98076235849,
                                                      2245.0909069522613,
                                                      -46085.965532968825,
                                                      3368.0297663885935,
                                                      -46181.67123182361,
                                                      3239.560649157949,
                                                      25363.379368344074,
                                                      -10327.329631677007,
                                                      17717.231571577973,
                                                      -14227.688657963068,
                                                      24580.31394401792,
                                                      -20651.84812237891,
                                                      29134.693387320112,
                                                      -20154.540583292346,
                                                      43080.7529227066,
                                                      -53708.2135814389,
                                                      42441.16001053327,
                                                      -53731.92238527414,
                                                      47976.84240392968,
                                                      -46216.28781449849,
                                                      -11900.910297907809,
                                                      29882.832150688133,
                                                      -13187.917157702086,
                                                      31025.252493533244,
                                                      -9792.284371446513,
                                                      26838.581081892436,
                                                      -11269.14276649128,
                                                      27429.718875382947,
                                                      -5660.728920526542,
                                                      24574.667692997973,
                                                      11253.80330805089,
                                                      -25008.651718108995,
                                                      10466.359767099839,
                                                      -25641.114108769514,
                                                      -53252.1312259309,
                                                      -20391.068111358632,
                                                      -47799.02030720808,
                                                      -22136.879760045675,
                                                      -51379.57629207311,
                                                      -22500.143694694954,
                                                      -54427.60141284903,
                                                      -22433.79562519107,
                                                      -42057.65623242821,
                                                      -21445.145056313435,
                                                      -42664.076601666646,
                                                      -12631.148780933434,
                                                      -45804.81458842004,
                                                      -5175.118656235392,
                                                      -45478.89283457703,
                                                      -4974.014748854219,
                                                      47075.997568824576,
                                                      27174.33433031141,
                                                      53844.0068681668,
                                                      26125.565202999907,
                                                      -22445.721811471412,
                                                      5947.414031173117,
                                                      -20797.59708432936,
                                                      4231.314002562816,
                                                      -22012.560374600253,
                                                      5514.803686442698,
                                                      -25647.96389715412,
                                                      -10242.011092887318,
                                                      -24850.718783507502,
                                                      -5594.456938161081,
                                                      -23637.972304660132,
                                                      -8240.143243956536,
                                                      34882.04958914149,
                                                      29690.35080922088,
                                                      26678.65752711494,
                                                      28639.788268322274,
                                                      -45859.8782408588,
                                                      -40730.76985862218,
                                                      -51933.96309224814,
                                                      -45679.557409096116,
                                                      -52099.29330373669,
                                                      -45875.37994370673,
                                                      34549.11186911959,
                                                      4411.4930198940565,
                                                      28645.239864180556,
                                                      254.8442404411453,
                                                      29729.362290067365,
                                                      51400.29090932576,
                                                      27092.22625228292,
                                                      57412.291246702465,
                                                      27270.331741995822,
                                                      61044.43950242366,
                                                      27375.014737974416,
                                                      60938.90864558535,
                                                      51556.57410969483,
                                                      -6739.644077840145,
                                                      52515.470545460434,
                                                      -8987.498835679566,
                                                      46638.54343817407,
                                                      -5237.371348479321,
                                                      11226.929260803649,
                                                      48448.32078503046,
                                                      12712.496694281563,
                                                      40259.71525300039,
                                                      8563.557289261611,
                                                      36673.04699761284,
                                                      -45375.67258113653,
                                                      36335.05760810802,
                                                      -44857.41642126795,
                                                      36616.26156028952,
                                                      -51428.472725871936,
                                                      35645.440993282224,
                                                      11948.653896420248,
                                                      -24706.94842684488,
                                                      20671.682144587314,
                                                      -21833.197922278516,
                                                      19203.379064891342,
                                                      -20118.5370559781,
                                                      54438.42614275502,
                                                      -29144.161044259497,
                                                      57867.96483019572,
                                                      -28841.39017934311,
                                                      54260.19148082872,
                                                      -33361.50604871394,
                                                      -43454.69314619985,
                                                      50273.6558612583,
                                                      -49657.47783440756,
                                                      53577.41459418893,
                                                      -48847.36106727273,
                                                      62172.47019181349,
                                                      -12962.581910456334,
                                                      56440.56024064429,
                                                      -11078.09318399874,
                                                      51644.12024048194,
                                                      33050.658148590956,
                                                      -58920.77248277155,
                                                      33853.16958578488,
                                                      -58722.31903774217,
                                                      30155.859199122297,
                                                      -61546.90999392407,
                                                      28350.944868052207,
                                                      -61763.752766007725,
                                                      -19670.72089334298,
                                                      22684.517798921064,
                                                      -19640.1421625446,
                                                      22687.978622624778,
                                                      -15653.90150936818,
                                                      17615.43390847237,
                                                      -5820.125752277603,
                                                      17014.434363396143,
                                                      60491.9147275399,
                                                      -44454.646506475365,
                                                      61673.61389764642,
                                                      -40670.4296948947,
                                                      3010.22884329714,
                                                      9528.274005783183,
                                                      7247.472877158092,
                                                      15124.702546599536,
                                                      4851.4337295382575,
                                                      11243.865962023567,
                                                      4824.133938941079,
                                                      11227.68978808053,
                                                      23504.266167053705,
                                                      33179.85253067702,
                                                      22480.863815579512,
                                                      28906.810162650283,
                                                      24342.637759549954,
                                                      28007.697772657713,
                                                      24137.50967310437,
                                                      27353.98686292031,
                                                      -34053.41026040829,
                                                      -64265.88574718186,
                                                      -32110.577393759428,
                                                      -63130.20151200131,
                                                      -33924.15109989719,
                                                      -65536.0,
                                                      -31672.687599811205,
                                                      -64581.179304206045,
                                                      959.7215557354066,
                                                      24452.397751976227,
                                                      312.56653151161856,
                                                      23231.56579123238,
                                                      -44.98033879071096,
                                                      23394.965100601486,
                                                      296.376589694366,
                                                      -6558.590930642116,
                                                      3994.3950419367184,
                                                      -3700.7274032742203,
                                                      7696.985767894743,
                                                      -3191.0326641728143,
                                                      -6387.18605725986,
                                                      19774.367993523556,
                                                      -8051.394792809615,
                                                      27694.462346775483,
                                                      -10110.413864642014,
                                                      29492.85073406865,
                                                      -19847.050217164695,
                                                      -14028.154415987468,
                                                      -14080.09841584025,
                                                      -18353.14544453502,
                                                      -22849.163678809855,
                                                      -36813.45891756001,
                                                      -28963.47174786276,
                                                      -36692.297960659314,
                                                      -31847.193110264172,
                                                      -35588.66043701308,
                                                      7105.9171509791195,
                                                      -39033.80716796027,
                                                      11460.775360755784,
                                                      -40282.86309943496,
                                                      58942.469515078075,
                                                      6787.262920580673,
                                                      58886.86547401938,
                                                      5863.573743095374,
                                                      58740.01428115593,
                                                      222.51042578771012,
                                                      61283.97291509698,
                                                      3999.5819537617244,
                                                      -63061.08699755168,
                                                      -2575.8629341373526,
                                                      -65536.0,
                                                      -9285.81901768746,
                                                      -50035.37045591002,
                                                      20537.513037427605,
                                                      -50081.11003362366,
                                                      20464.263706784554,
                                                      62116.35229456691,
                                                      45745.60016019519,
                                                      61865.80519887989,
                                                      40883.516880131516,
                                                      62647.124391193276,
                                                      40468.27973749191,
                                                      56654.5141685885,
                                                      16862.303937885663,
                                                      63070.85134584749,
                                                      23300.195766204517,
                                                      61230.41706849119,
                                                      19510.84090013759,
                                                      60415.518333547,
                                                      11527.62347437564,
                                                      55656.31580105885,
                                                      30108.422086075327,
                                                      46134.25777282618,
                                                      32185.644483843284,
                                                      968.041379812712,
                                                      -30593.64787082193,
                                                      5360.019466310152,
                                                      -31328.665492243064,
                                                      3662.5289196361346,
                                                      -23533.58815929447,
                                                      5459.910428930167,
                                                      -18274.379953033775,
                                                      53419.848320399906,
                                                      -64165.83874253259,
                                                      54341.74882672624,
                                                      -65536.0,
                                                      56149.34611529181,
                                                      -65536.0,
                                                      63518.943955564784,
                                                      -65536.0,
                                                      63041.55390377034,
                                                      -52961.48936175517,
                                                      55648.26343059204,
                                                      -54114.30757859672,
                                                      56045.45020144504,
                                                      -51233.966551424906,
                                                      -14313.208636322757,
                                                      54248.41327512142,
                                                      -14485.732740432964,
                                                      55940.25897158489,
                                                      -13268.3777837889,
                                                      49763.46359174742,
                                                      -13231.945672727452,
                                                      44703.96058500886,
                                                      -5885.21758056189,
                                                      52829.13296404347,
                                                      -5131.159534487515,
                                                      52609.69351861534,
                                                      -9074.90834159211,
                                                      43460.75312509922,
                                                      -43855.71514428074,
                                                      9158.508068670606,
                                                      -48053.80969115072,
                                                      9979.665281410318,
                                                      40831.07071986032,
                                                      11222.362498340124,
                                                      43149.63435633618,
                                                      13070.612773966097,
                                                      47679.105915171785,
                                                      14130.01460673544,
                                                      48400.939321371276,
                                                      14714.801284683483,
                                                      -9650.464759378563,
                                                      -57391.84915603173,
                                                      -7249.958103471297,
                                                      -58226.95924387508,
                                                      -5082.082168062301,
                                                      -58745.47381533096,
                                                      -63939.909793905674,
                                                      15155.582389704374,
                                                      -63781.97553502955,
                                                      15037.11344237593,
                                                      -65311.39108408277,
                                                      15343.059647357972,
                                                      -5848.2556516926925,
                                                      -31139.67098988675,
                                                      317.32328031093675,
                                                      -36811.17803062407,
                                                      -812.6531797336165,
                                                      -36621.07177150081,
                                                      -3364.6381580844895,
                                                      -34954.03004912029,
                                                      -52564.38671359332,
                                                      -3600.7938606276584,
                                                      -58093.41581969953,
                                                      -4872.609255570671,
                                                      -59668.83618647987,
                                                      -5828.29321364815,
                                                      14353.60218457671,
                                                      -5228.363965939694,
                                                      13841.579397954565,
                                                      -4650.89050636443,
                                                      9137.396816561348,
                                                      1036.6629270363055,
                                                      8610.296312929777,
                                                      6139.780821150885,
                                                      -7055.315970087351,
                                                      46568.89864530167,
                                                      -549.2613965357859,
                                                      40189.53608848613,
                                                      2300.4279681102403,
                                                      49413.6690830616,
                                                      55435.82976249409,
                                                      28866.760874538086,
                                                      55192.80876167619,
                                                      27631.122043076637,
                                                      50532.24048212488,
                                                      31651.373637217555,
                                                      -49374.35589090375,
                                                      51743.92736162846,
                                                      -47508.15225702733,
                                                      50894.0772057776,
                                                      -50682.16982805728,
                                                      54730.606260802306,
                                                      -50920.08172662605,
                                                      53139.583948321655,
                                                      45260.20728762291,
                                                      4527.564954490968,
                                                      48517.03233951705,
                                                      12189.838122257905,
                                                      46124.822155460206,
                                                      10814.215470535108,
                                                      54828.216215604654,
                                                      14090.173961864257,
                                                      44771.72815631704,
                                                      -38155.22830457595,
                                                      40575.91154447274,
                                                      -40869.613927092214,
                                                      40875.303023973545,
                                                      -38550.35052437827,
                                                      45065.28856600735,
                                                      -39694.9360220942,
                                                      15683.489154164097,
                                                      43498.596550403585,
                                                      23392.984508151996,
                                                      49508.0115361974,
                                                      31539.806796075267,
                                                      17528.07416632102,
                                                      31791.109097684202,
                                                      18452.718659632777,
                                                      -23000.113733128106,
                                                      5502.854897138503,
                                                      -18094.479708501316,
                                                      -1477.9959109331921,
                                                      -11357.201200332272,
                                                      984.4075834326218,
                                                      -9345.838925153008,
                                                      1497.5246961748412,
                                                      -55479.287132797836,
                                                      16890.74546327388,
                                                      -52287.397277835524,
                                                      11323.02179734331,
                                                      10818.487974743519,
                                                      7195.558456095547,
                                                      9714.158308423997,
                                                      5524.004040319631,
                                                      3850.7591574230764,
                                                      12912.134627293335});

  auto linestring2_offsets = make_device_vector<int32_t>(
    {0,   2,   4,   6,   8,   10,  13,  15,  17,  20,  23,  25,  29,  33,  35,  37,  41,
     45,  47,  51,  53,  56,  59,  63,  66,  69,  71,  73,  76,  79,  82,  84,  86,  89,
     93,  96,  98,  100, 103, 105, 107, 109, 113, 116, 119, 123, 126, 129, 133, 137, 139,
     143, 147, 149, 151, 154, 156, 159, 163, 166, 168, 170, 174, 178, 181, 183, 187, 191,
     195, 197, 200, 203, 205, 209, 213, 216, 220, 224, 226, 229, 233, 236, 239, 241, 245,
     248, 250, 252, 254, 256, 258, 260, 262, 264, 267, 269, 271, 275, 279, 281, 283});

  auto linestring2_points_xy = make_device_vector<T>({24046.170375947084,
                                                      27878.56737867571,
                                                      20614.007047185743,
                                                      26489.74880629428,
                                                      48381.39607717942,
                                                      -8366.313156569413,
                                                      53346.77764665915,
                                                      -2066.3869793077383,
                                                      4365.496374409238,
                                                      -59857.47177852941,
                                                      1671.0269165650761,
                                                      -54931.9723439855,
                                                      60135.10576713836,
                                                      38267.53117681052,
                                                      58117.0215375236,
                                                      36251.55819542643,
                                                      -51494.78094358275,
                                                      -35492.093406511354,
                                                      -59291.16312346822,
                                                      -30996.522241808714,
                                                      17527.070262173787,
                                                      -8086.285571402303,
                                                      16140.128075758206,
                                                      -8722.081551830386,
                                                      21178.29035078248,
                                                      -10309.220371703479,
                                                      -46247.99797412497,
                                                      -61650.13799282254,
                                                      -41770.15815787812,
                                                      -57748.869143045675,
                                                      52439.4128584852,
                                                      36589.77853063609,
                                                      50908.38296602024,
                                                      42382.411142883866,
                                                      64834.271974236326,
                                                      -42009.03475077734,
                                                      61946.67345113476,
                                                      -43330.160502115265,
                                                      62022.52832061858,
                                                      -43384.801359486424,
                                                      34288.18665219756,
                                                      54315.73045932353,
                                                      28300.340620382718,
                                                      51572.7217483208,
                                                      27656.378043110635,
                                                      49660.694514521245,
                                                      30794.000810035635,
                                                      -17613.940599695612,
                                                      32431.166581550326,
                                                      -25461.00124870416,
                                                      33756.666022670746,
                                                      2930.21018621228,
                                                      29664.709989066603,
                                                      7242.93476191668,
                                                      28856.873418914183,
                                                      7089.2529879860085,
                                                      36401.141148038514,
                                                      7935.493948240266,
                                                      17079.944290857253,
                                                      -16918.249798314413,
                                                      13233.118633426348,
                                                      -14646.772596539959,
                                                      18010.65672629887,
                                                      -15149.208298184116,
                                                      21733.55299266447,
                                                      -14858.399234970673,
                                                      -17589.12911703354,
                                                      8582.92848550067,
                                                      -13615.42999872126,
                                                      9399.867477813053,
                                                      -16962.899142052956,
                                                      65388.53291753703,
                                                      -14652.153991738582,
                                                      60708.706373685935,
                                                      21114.93723313787,
                                                      -47038.67484287539,
                                                      12910.922082281972,
                                                      -44436.974813653,
                                                      3453.1479188972626,
                                                      -46995.81345855274,
                                                      9769.675794028683,
                                                      -49609.90494990711,
                                                      1835.0514383492991,
                                                      48347.77610172224,
                                                      7756.834125617577,
                                                      44246.251316360154,
                                                      7640.602544577206,
                                                      47019.96704512191,
                                                      13341.58730161298,
                                                      42963.21484589453,
                                                      -28356.501919974988,
                                                      -63963.528608225024,
                                                      -28174.220475611586,
                                                      -65536.0,
                                                      46825.329124044074,
                                                      9787.392704550977,
                                                      44931.59733150601,
                                                      13439.672239478117,
                                                      38981.41926874932,
                                                      14496.797392844519,
                                                      47795.98186123269,
                                                      10148.60153259868,
                                                      -11635.295606788517,
                                                      -22651.800929712503,
                                                      -9497.235815058624,
                                                      -16649.619216575462,
                                                      62099.48615805716,
                                                      4650.1450472288125,
                                                      65535.0,
                                                      5266.110859827297,
                                                      65535.0,
                                                      3936.628491570741,
                                                      -21737.429366590455,
                                                      -53166.445914731725,
                                                      -29042.47786349059,
                                                      -49617.99069091295,
                                                      -31559.31294702657,
                                                      -47231.27985078154,
                                                      50336.084698268794,
                                                      8788.390044775617,
                                                      54641.49898855221,
                                                      17752.918413051135,
                                                      54523.92417903646,
                                                      17785.48180855107,
                                                      59810.65384878393,
                                                      10113.020826958591,
                                                      26109.768995279854,
                                                      -26392.86781490936,
                                                      33260.44533620665,
                                                      -31199.62771961264,
                                                      32718.50253715998,
                                                      -23532.925723013777,
                                                      -17046.478062460723,
                                                      57219.46266513846,
                                                      -13637.902612846676,
                                                      60642.27166155047,
                                                      -4048.4940472536837,
                                                      61672.0437816363,
                                                      -1295.089691202047,
                                                      -41852.75719372246,
                                                      -7280.143953298165,
                                                      -43849.18942821618,
                                                      23307.510964401692,
                                                      -717.0576789254337,
                                                      21057.78812228635,
                                                      -2232.2731039226383,
                                                      61422.584748784095,
                                                      -22610.261973542678,
                                                      64125.26236976497,
                                                      -19523.462020800576,
                                                      63035.70068773205,
                                                      -18869.673007678663,
                                                      13293.405087485866,
                                                      -2103.483618004,
                                                      8301.321717837485,
                                                      -10147.547174846575,
                                                      5998.566973034347,
                                                      -16730.549997477177,
                                                      56807.6229253363,
                                                      -27317.888774417457,
                                                      57284.20136469141,
                                                      -27086.391416319588,
                                                      50134.09712451558,
                                                      -22462.000404223618,
                                                      62815.690002302246,
                                                      64266.97812828068,
                                                      65535.0,
                                                      65181.25034103983,
                                                      18587.476388271883,
                                                      -15484.952003835955,
                                                      12698.56647818971,
                                                      -18101.653694566507,
                                                      -11373.280290722301,
                                                      17916.24799952947,
                                                      -8161.778140116089,
                                                      24701.144709586413,
                                                      -8351.822845788342,
                                                      16320.106016260504,
                                                      47561.334575670524,
                                                      -61771.384861674625,
                                                      48323.03876944549,
                                                      -52782.31111036583,
                                                      47791.130474422665,
                                                      -51611.64259346673,
                                                      51987.019421589604,
                                                      -58989.588758878,
                                                      -19455.18463768006,
                                                      -7478.666862188162,
                                                      -23739.805394183597,
                                                      -11380.37022343936,
                                                      -22568.658462124997,
                                                      -12709.082125210938,
                                                      23024.079178510918,
                                                      5900.72118584835,
                                                      28644.583218064923,
                                                      6395.841589041828,
                                                      7298.377778265756,
                                                      -55978.826431399255,
                                                      3625.7721728530732,
                                                      -55062.60168794985,
                                                      -21594.37878249857,
                                                      37912.85012154847,
                                                      -22515.531339327168,
                                                      38262.034642766,
                                                      -20627.42673352121,
                                                      34956.5884614418,
                                                      6099.222612896439,
                                                      -35145.05363149654,
                                                      8638.445704296702,
                                                      -35939.357720932756,
                                                      32011.353490737194,
                                                      20628.088617133108,
                                                      33208.75937007324,
                                                      11686.499722223638,
                                                      926.164443453119,
                                                      -24627.362833606363,
                                                      5399.2313731423565,
                                                      -31482.750775167715,
                                                      28186.645319993637,
                                                      31249.7777028766,
                                                      28427.65541715838,
                                                      40956.78233333402,
                                                      28433.54857881469,
                                                      41382.55735505147,
                                                      28309.21054975733,
                                                      40949.902974637465,
                                                      49744.365575383126,
                                                      -10.964158675378712,
                                                      41951.7110218391,
                                                      4770.269588717389,
                                                      40709.44234829844,
                                                      3198.097209205037,
                                                      59428.37014680178,
                                                      14411.554889602106,
                                                      60774.58995358354,
                                                      11842.033811629492,
                                                      57864.97505832654,
                                                      9460.225339476907,
                                                      -12909.579379351642,
                                                      55717.70516195832,
                                                      -14169.062767062256,
                                                      53617.874969892895,
                                                      -9472.376817936885,
                                                      54665.959995777615,
                                                      -8594.555656534549,
                                                      53988.3093805043,
                                                      43445.5342784347,
                                                      41378.23077159966,
                                                      44146.51386658679,
                                                      40781.74245924522,
                                                      44254.395924099306,
                                                      40657.70325237871,
                                                      56695.86940969313,
                                                      -29453.542015459017,
                                                      57328.3459955809,
                                                      -28477.80164078998,
                                                      59869.09421652202,
                                                      -33718.83540943996,
                                                      -48476.01256692005,
                                                      -29773.72523753837,
                                                      -40572.476190618385,
                                                      -31506.14700839999,
                                                      -41372.611441455665,
                                                      -31968.71507990374,
                                                      -38102.79223698782,
                                                      -34365.65716442856,
                                                      -34160.875071055634,
                                                      52633.69733453568,
                                                      -31851.944660451976,
                                                      50296.82323369251,
                                                      -33560.36758089234,
                                                      51932.64482266117,
                                                      -38956.59298786371,
                                                      51395.3773978117,
                                                      47875.729875354155,
                                                      -42824.239844062744,
                                                      47054.15007723312,
                                                      -48565.279343794704,
                                                      -15763.28154735428,
                                                      -29759.144315022422,
                                                      -15022.415565328583,
                                                      -28573.755091528295,
                                                      -15505.259361620036,
                                                      -29102.584349813173,
                                                      -19433.918706189022,
                                                      -26602.17892560728,
                                                      21039.330729276393,
                                                      -28092.517122859063,
                                                      25459.011149795857,
                                                      -30812.128281190624,
                                                      24228.2200937306,
                                                      -32209.51925460922,
                                                      24172.896324114823,
                                                      -31934.77114210906,
                                                      37641.61613795927,
                                                      -16784.00232362718,
                                                      40093.808079273986,
                                                      -16102.651271585919,
                                                      -64986.04229495289,
                                                      35908.33715749516,
                                                      -65536.0,
                                                      30399.598745360658,
                                                      28865.9861058433,
                                                      34047.384049482804,
                                                      31404.205373670076,
                                                      28209.48536627418,
                                                      32824.92139989007,
                                                      31638.569927646782,
                                                      44076.96662980942,
                                                      -43893.614732363516,
                                                      42816.334617183755,
                                                      -49376.46085597309,
                                                      -2337.065372176352,
                                                      34161.781762612896,
                                                      -2454.820165021252,
                                                      34097.1586408793,
                                                      -21.24489065693888,
                                                      25069.348380772386,
                                                      25862.23076924747,
                                                      18388.771898399136,
                                                      19792.249382429145,
                                                      19068.829437310942,
                                                      19725.81703503653,
                                                      19711.266488167785,
                                                      13486.339170409647,
                                                      24161.905632044534,
                                                      -14132.32043340936,
                                                      44472.64135889089,
                                                      -13264.825037065333,
                                                      43720.18641032237,
                                                      -19408.894071066446,
                                                      48340.64725467226,
                                                      61758.285121524066,
                                                      6192.966639155318,
                                                      61694.84484358259,
                                                      6203.925100411371,
                                                      61864.79059036865,
                                                      50177.877934877455,
                                                      65535.0,
                                                      47460.44816783662,
                                                      -6015.210967517021,
                                                      -12024.648545975433,
                                                      -625.9021770409745,
                                                      -4535.826811613984,
                                                      -1591.306712085287,
                                                      -3650.5896577858566,
                                                      3500.835626990062,
                                                      -5506.66998864992,
                                                      52952.65614611846,
                                                      29128.118385679612,
                                                      47855.49296434603,
                                                      33226.99065949976,
                                                      45493.81677973004,
                                                      23780.999647643548,
                                                      43215.72762748768,
                                                      28153.639507364693,
                                                      -62101.353403045774,
                                                      78.10279978545441,
                                                      -61218.466272761565,
                                                      5285.053409188442,
                                                      -61234.41962391241,
                                                      5290.62055375181,
                                                      21279.822206688157,
                                                      60345.148716865806,
                                                      28494.696527078828,
                                                      59151.976112230004,
                                                      23243.054165080714,
                                                      -50613.88913731222,
                                                      22547.3541411588,
                                                      -43699.717849091336,
                                                      15981.433995230766,
                                                      -39309.64770588452,
                                                      25826.998040730832,
                                                      -39663.51573174535,
                                                      -57172.87410962715,
                                                      20706.3739822825,
                                                      -54766.5759124097,
                                                      21403.946896398676,
                                                      -52573.1116877078,
                                                      22086.225322397677,
                                                      -49403.2785052861,
                                                      26273.919710552575,
                                                      -7186.542641911306,
                                                      -61710.11359807797,
                                                      -6831.412373191683,
                                                      -60698.66473027073,
                                                      -5756.376457916045,
                                                      -62824.68291452278,
                                                      3071.2106591016236,
                                                      -61261.88209984583,
                                                      -40420.610893629855,
                                                      18127.01517363607,
                                                      -48596.10517985245,
                                                      19695.781188654408,
                                                      31670.60357638674,
                                                      -41486.82735240817,
                                                      28210.377929556533,
                                                      -41060.330490692075,
                                                      23561.64629790607,
                                                      -45516.04807930786,
                                                      -7393.259429801445,
                                                      40633.40566135118,
                                                      -7262.980859354975,
                                                      41663.87208196797,
                                                      -14498.642533421951,
                                                      38449.17335973677,
                                                      -34278.03300122521,
                                                      -56644.6926276484,
                                                      -27990.859726387403,
                                                      -63116.90663080004,
                                                      -35069.67232490826,
                                                      37361.362547205834,
                                                      -37033.13416444959,
                                                      30364.58784041123,
                                                      -37012.08647477349,
                                                      30681.304342515174,
                                                      -40242.36130845048,
                                                      28855.462978012318,
                                                      32002.517735259913,
                                                      -21987.243717104902,
                                                      30237.44459095604,
                                                      -27379.028811674485,
                                                      31104.766970006913,
                                                      -27074.127128785443,
                                                      25197.350474127827,
                                                      -33362.541325203565,
                                                      -41345.515497687134,
                                                      -58053.93959030788,
                                                      -42036.75176539078,
                                                      -61657.50738405434,
                                                      -37844.484580749326,
                                                      -63873.143833855625,
                                                      -63374.289355131164,
                                                      37016.129171396096,
                                                      -63381.35611551266,
                                                      33524.920248630624,
                                                      -62896.82969782667,
                                                      33784.191693610635,
                                                      -65536.0,
                                                      39523.342546361375,
                                                      19624.504208243205,
                                                      -58150.579505434085,
                                                      26889.54650881527,
                                                      -57528.51151392309,
                                                      27539.646814152253,
                                                      -56378.35863513876,
                                                      26048.399472263092,
                                                      -54132.85083611531,
                                                      56254.770257432174,
                                                      45463.00317181047,
                                                      56748.84925441912,
                                                      43746.11772809386,
                                                      9885.400008618206,
                                                      23991.38982378789,
                                                      11165.624242290589,
                                                      24328.329001705166,
                                                      14734.845074957582,
                                                      24658.683567616314,
                                                      64190.81654132414,
                                                      -9205.219837602555,
                                                      61300.439943480895,
                                                      -12202.040491158052,
                                                      65535.0,
                                                      -8368.457799985794,
                                                      65535.0,
                                                      -3823.856228930549,
                                                      39049.40622870173,
                                                      -25743.589685013503,
                                                      35265.00781139653,
                                                      -24495.380332734436,
                                                      35113.170257716505,
                                                      -24633.63627818454,
                                                      -39954.000140931545,
                                                      -58013.64463594009,
                                                      -35513.47414803935,
                                                      -65536.0,
                                                      -34441.82917511126,
                                                      -65536.0,
                                                      34088.60614329163,
                                                      43594.20653120625,
                                                      28700.380052950874,
                                                      42070.82051457739,
                                                      -36862.33271057148,
                                                      8307.234739860229,
                                                      -32859.01583612004,
                                                      10956.658157004455,
                                                      -31191.871795637373,
                                                      15817.792373324339,
                                                      -32003.331177652333,
                                                      20551.44779746299,
                                                      -13107.83700891627,
                                                      42872.525866358264,
                                                      -14688.500860708387,
                                                      38601.73767513557,
                                                      -18245.151473017104,
                                                      33305.31165731295,
                                                      -32525.725628515836,
                                                      21915.76596169251,
                                                      -33993.91682329715,
                                                      22187.083798396245,
                                                      -20285.86810731778,
                                                      8878.050464641972,
                                                      -20033.131856054162,
                                                      7329.012948283676,
                                                      27300.596012974405,
                                                      -8923.000585077694,
                                                      26442.988504072695,
                                                      -5957.730299055878,
                                                      51574.33506953686,
                                                      42988.068045101856,
                                                      48117.52341383863,
                                                      41995.973894229064,
                                                      -21268.443508450517,
                                                      606.5265997462848,
                                                      -24169.969300778987,
                                                      4584.574914234327,
                                                      -333.7059961781342,
                                                      -15000.66037914269,
                                                      1154.802032476863,
                                                      -23481.51835062977,
                                                      14199.246880886509,
                                                      -34169.010785194405,
                                                      20052.224683135122,
                                                      -27270.698407036958,
                                                      9983.515767545046,
                                                      -47272.24666691125,
                                                      11151.159484611626,
                                                      -45805.26551921326,
                                                      -56914.308516713114,
                                                      37722.89763812795,
                                                      -54641.0075204614,
                                                      42314.87487608766,
                                                      -59020.748909382295,
                                                      39496.29702855225,
                                                      44354.7875333885,
                                                      53499.2552621721,
                                                      45229.63048249438,
                                                      47617.793038744414,
                                                      17233.635105441615,
                                                      38604.48437014686,
                                                      22050.24381358763,
                                                      44812.19238923583,
                                                      -28857.15840988976,
                                                      -49424.475982191696,
                                                      -27129.837207157525,
                                                      -45186.618133268355,
                                                      -27069.304704059105,
                                                      -45232.76215178083,
                                                      -23631.070550460405,
                                                      -54597.0418612454,
                                                      -10729.591221458599,
                                                      -12119.938636133666,
                                                      -8664.132241471627,
                                                      -15205.054401436506,
                                                      -12718.241381101057,
                                                      -17599.196968326814,
                                                      -14303.205344482918,
                                                      -18083.072472929212,
                                                      55134.27218389536,
                                                      56421.5370066538,
                                                      55223.4192757591,
                                                      56480.56370818126,
                                                      35717.66938371734,
                                                      -59201.01835964643,
                                                      35472.01653855634,
                                                      -59182.15595508969});

  auto expected = make_device_vector<T>(
    {22000.86425379464,  66907.56415814416,  91319.97744223749,  85968.18301126428,
     102672.3263797747,  65694.82522031936,  23155.596407172834, 69965.78080466804,
     74404.84663547449,  50401.990020141246, 86674.09733792665,  78620.63597017915,
     50270.741668061564, 21742.759144551062, 57053.338441131185, 59274.33513507705,
     48859.389221588026, 81538.69583988942,  102451.30976584884, 48907.78040391256,
     2541.1783777563724, 54018.73837654963,  80019.79050636332,  99125.18435170795,
     86909.77084040688,  100366.96181026987, 68313.25509221756,  97214.36651018754,
     60564.99623503783,  79060.78098596593,  120581.50538980225, 42683.374059987655,
     72540.83585301196,  97288.29179292868,  13733.85425546725,  15638.255020170804,
     99285.77366088502,  36490.14927299419,  22055.190136582223, 59756.41455959068,
     55999.06431045312,  34499.301972964764, 40783.02779733117,  110287.1568555378,
     66432.78557813511,  13775.437319014114, 84497.96964551898,  25978.924986056714,
     62408.80191071194,  93243.74615580632,  52325.4457234104,   79966.38779743231,
     12679.929187884523, 73553.57489706302,  73768.1449667809,   32163.1673140078,
     76843.7399743497,   62642.67444253966,  7647.299340786608,  70644.00936419012,
     75372.8193039762,   67974.71683210952,  38255.30745023753,  86968.76019213336,
     134523.96397533367, 64474.156010664876, 59565.33783639761,  80474.25882097102,
     38173.63396698884,  47219.681710204335, 80438.60559838371,  107397.04958322046,
     38840.989826087316, 92404.38320717831,  142972.7142246719,  120743.00851595176,
     88624.62602444092,  80480.41611758419,  96883.04928998687,  39384.08522694212,
     93051.51572055934,  106136.58472613667, 35435.02384720026,  7045.002778172422,
     61903.57835829537,  82540.74978755743,  43930.005897185314, 38805.25027105973,
     110525.61810095713, 30289.12339639058,  55190.61741153193,  65184.895015007314,
     113100.29945781764, 105574.82641833455, 85774.24359854191,  2878.1066075084723,
     85871.70969639975,  12523.482980018343, 116504.46834362095, 69644.48579719076});

  auto got = rmm::device_vector<T>(expected.size());

  auto linestring1_points_it = make_vec_2d_iterator(linestring1_points_xy.begin());
  auto linestring2_points_it = make_vec_2d_iterator(linestring2_points_xy.begin());

  auto mlinestrings1 = make_multilinestring_range(num_pairs,
                                                  thrust::make_counting_iterator(0),
                                                  linestring1_offsets.size() - 1,
                                                  linestring1_offsets.begin(),
                                                  linestring1_points_xy.size() / 2,
                                                  linestring1_points_it);
  auto mlinestrings2 = make_multilinestring_range(num_pairs,
                                                  thrust::make_counting_iterator(0),
                                                  linestring2_offsets.size() - 1,
                                                  linestring2_offsets.begin(),
                                                  linestring2_points_xy.size() / 2,
                                                  linestring2_points_it);

  auto ret = pairwise_linestring_distance(mlinestrings1, mlinestrings2, got.begin());

  if constexpr (std::is_same_v<T, double>)
    CUSPATIAL_EXPECT_VECTORS_EQUIVALENT(got, expected);
  else
    // allow error up to machine epsilon scaled by the max range of input coordinates
    CUSPATIAL_EXPECT_VECTORS_EQUIVALENT(
      got, expected, 65536.0f * 2 * std::numeric_limits<float>::epsilon());

  EXPECT_EQ(expected.size(), std::distance(got.begin(), ret));
}
